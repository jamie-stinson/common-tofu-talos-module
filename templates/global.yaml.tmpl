machine:
  install:
    diskSelector:
      size: '> 25GB'
    wipe: true
    extraKernelArgs:
        - console=ttyS1
        - panic=10
  systemDiskEncryption:
    ephemeral:
      provider: luks2
      keys:
        - nodeID: {}
          slot: 0
    state:
      provider: luks2
      keys:
        - nodeID: {}
          slot: 0
  network:
    hostname: ${hostname}
    nameservers:
      - ${primary_dns_server}
      - ${secondary_dns_server}
  time:
    servers:
      - ${ntp_server}
  files:
    - content: |
        [metrics]
          address = "0.0.0.0:11234"        
      path: /etc/cri/conf.d/20-customization.part
      op: create
  certSANs:
    - ${api_server}
  kubelet:
    nodeIP:
      validSubnets:
        - ${subnet}
    %{~ if extra_mounts != null ~}
    %{~ if length(extra_mounts) > 0 ~}
    extraMounts:
      %{~ for mount in extra_mounts ~}
      - destination: ${mount.destination}
        type: ${mount.type}
        source: ${mount.source}
        %{~ if mount.options != null ~}
        options:
          %{~ for option in mount.options ~}
          - ${option}
          %{~ endfor ~}
        %{~ endif ~}
      %{~ endfor ~}
    %{~ endif ~}
    %{~ endif ~}
